var re =  /(^(?:(?:(?:#\!.*)(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s)*)|(?:(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s)+)))|((?:"(?:(?:\\(?:.|\s))|(?:[^\\"\n\r]))*")|(?:'(?:(?:\\(?:.|\s))|(?:[^\\'\n\r]))*')|(?:\/(?!\*)(?:(?:\\(?:.|\s))|(?:[^\\\/\n\r]))*\/)|(?:`(?:(?:\\(?:.|\s))|(?:[^\\`]))*`))|((?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*(=|\{|\*|\[|\||&|\!|\?|\:|\^|\~|\(|\/(?!\*)|,|;|\.)(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*)|((?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*(\}|\]|\))(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*)|((?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*(\+{2,}|\-{2,}|>{2,}|<{2,})(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s)*(?:\n|\r)(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s)*)|((?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*(\+|\-|>|<)(?:(?:(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])(?!\10))|(?:((?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])(?=\10)))*)|((?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s)*(?:\n|\r)(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s)*)|((?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/.*)|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])+)/g,
    ure = /(^(?:(?:(?:#\!.*)(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))*)|(?:(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))+)))|((?:"(?:(?:\\(?:.|\s(?!$)))|(?:[^\\"\n\r]))*")|(?:'(?:(?:\\(?:.|\s(?!$)))|(?:[^\\'\n\r]))*')|(?:\/(?!\*)(?:(?:\\(?:.|\s(?!$)))|(?:[^\\\/\n\r]))*\/)|(?:`(?:(?:\\(?:.|\s(?!$)))|(?:[^\\`]))*`))|((?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))*(=|\{|\*|\[|\||&|\!|\?|\:|\^|\~|\(|\/(?!\*)|,|;|\.)(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))*)|((?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))*(\}|\]|\))(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*)|((?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))*(\+{2,}|\-{2,}|>{2,}|<{2,})(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))*(?:\n|\r)(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))*)|((?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))*(\+|\-|>|<)(?:(?:(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))(?!\10))|(?:((?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))(?=\10)))*)|((?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))*(?:\n|\r)(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|\s(?!$))*)|((?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/.*)|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])+)/g;

function replace(m, comment, string, nCollapse, nCollapsable, collapse, collapsable, msCollapse, msCollapsable, sCollapse, sCollapsable, sTrailing, lineFeed, space){
  if(comment) return '';
  if(string) return string;
  if(lineFeed) return '\n';
  if(space) return ' ';
  if(collapse) return collapsable;
  if(sCollapse) return sCollapsable + (sTrailing?sTrailing:'');
  if(nCollapse) return nCollapsable;
  if(msCollapse) return msCollapsable + '\n';
  return m;
}

module.exports = function nijm(src,ugly){
  if(ugly) return src.replace(ure,replace);
  return src.replace(re,replace);
};
