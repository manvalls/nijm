var re =  /(^(?:(?:(?:#\!.*)(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s)*)|(?:(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s)+)))|((?:"(?:(?:\\(?:.|\s))|(?:[^\\"\n\r]))*")|(?:'(?:(?:\\(?:.|\s))|(?:[^\\'\n\r]))*')|(?:\/(?![\*\/])(?:(?:\\(?:.|\s))|(?:[^\\\/\n\r]))*\/)|(?:`(?:(?:\\(?:.|\s))|(?:[^\\`]))*`))|((?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*(=|\{|\*|\[|\||&|\!|\?|\:|\^|\~|\(|\/(?![\*\/])|,|;|\.)(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*)|((?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*(\}|\]|\))(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*)|((?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*(\+{2,}|\-{2,}|>{2,}|<{2,})(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s)*(?:\n|\r)(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s)*)|((?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*(\+|\-|>|<)(?:(?:(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])(?!\10))|(?:((?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])(?=\10)))*)|((?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s)*(?:\n|\r)(?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s)*)|((?:(?:\/\*(?:.|\s)*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])+)/g,
    ure = /(^(?:(?:(?:#\!.*)(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))*)|(?:(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))+)))|((?:"(?:(?:\\(?:.|\s(?!$)))|(?:[^\\"\n\r]))*")|(?:'(?:(?:\\(?:.|\s(?!$)))|(?:[^\\'\n\r]))*')|(?:\/(?![\*\/])(?:(?:\\(?:.|\s(?!$)))|(?:[^\\\/\n\r]))*\/)|(?:`(?:(?:\\(?:.|\s(?!$)))|(?:[^\\`]))*`))|((?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))*(=|\{|\*|\[|\||&|\!|\?|\:|\^|\~|\(|\/(?![\*\/])|,|;|\.)(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))*)|((?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))*(\}|\]|\))(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])*)|((?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))*(\+{2,}|\-{2,}|>{2,}|<{2,})(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))*(?:\n|\r)(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))*)|((?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))*(\+|\-|>|<)(?:(?:(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))(?!\10))|(?:((?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))(?=\10)))*)|((?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))*(?:\n|\r)(?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|\s(?!$))*)|((?:(?:\/\*(?:.|\s(?!$))*?(?:(?:\*\/)|$))|(?:\/\/(?:.*)(?=[\n\r\u2028\u2029]))|[ \t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])+)/g;

function replace(m, comment, string, nCollapse, nCollapsable, collapse, collapsable, msCollapse, msCollapsable, sCollapse, sCollapsable, sTrailing, lineFeed, space){
  if(comment) return '';
  if(string) return string;
  if(lineFeed) return '\n';
  if(space) return ' ';
  if(collapse) return collapsable;
  if(sCollapse) return sCollapsable + (sTrailing?sTrailing:'');
  if(nCollapse) return nCollapsable;
  if(msCollapse) return msCollapsable + '\n';
  return m;
}

module.exports = function nijm(src,ugly){
  if(ugly) return src.replace(ure,replace);
  return src.replace(re,replace);
};
